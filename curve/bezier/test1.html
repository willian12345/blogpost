<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body {
      margin: 0;
        background-color: ivory;
    }
    #canvas {
        border:1px solid green;
    }
  </style>
</head>
<body>
  
    <canvas id="canvas" width=800 height=800></canvas>
    <script>
      // 获取canvas和context
  const canvas = document.getElementById('canvas');
  const context = canvas.getContext('2d');
  // 定义三次贝塞尔曲线的控制点坐标
  var startX = 50;
  var startY = 200;
  var control1X = 150;
  var control1Y = 50;
  var control2X = 250;
  var control2Y = 350;
  var endX = 350;
  var endY = 200;

  // 绘制曲线
  context.beginPath();
  context.moveTo(startX, startY);
  context.bezierCurveTo(control1X, control1Y, control2X, control2Y, endX, endY);
  context.stroke();



  const getCoord = (t) => {
    const x0 = startX;
    const x1 = control1X;
    const x2 = control2X;
    const x3 = endX;
    const y0 = startY;
    const y1 = control1Y;
    const y2 = control2Y;
    const y3 = endY;
    const A = x3 - 3 * x2 + 3 * x1 - x0
    const B = 3 * x2 - 6 * x1 + 3 * x0
    const C = 3 * x1 - 3 * x0
    const D = x0

    const E = y3 - 3 * y2 + 3 * y1 - y0
    const F = 3 * y2 - 6 * y1 + 3 * y0
    const G = 3 * y1 - 3 * y0
    const H = y0;
    let x = A * Math.pow(t, 3) + B * Math.pow(t, 2) + C * t + D 
    let y = E * Math.pow(t, 3) + F * Math.pow(t, 2) + G * t + H 
    return [x, y]
  }
  
  // 在曲线上选择20个点，绘制垂直于曲线的切线
  for (var i = 0; i <= 20; i++) {
    var t = i / 20; // 曲线上的参数值
    const [x, y] = getCoord(t)
    // 计算切线斜率
    var dx = 3 * (1 - t) * (1 - t) * (control1X - startX) + 6 * (1 - t) * t * (control2X - control1X) + 3 * t * t * (endX - control2X);
    var dy = 3 * (1 - t) * (1 - t) * (control1Y - startY) + 6 * (1 - t) * t * (control2Y - control1Y) + 3 * t * t * (endY - control2Y);
    var tangentSlope = dy / dx;

    // 计算垂直斜率
    var perpendicularSlope =  tangentSlope;

    // 计算切线方程
    var tangentStartX = startX + t * (control1X - startX);
    var tangentStartY = startY + t * (control1Y - startY);
    var tangentEndX = endX + t * (control2X - endX);
    var tangentEndY = endY + t * (control2Y - endY);
    var perpendicularStartX = tangentStartX;
    var perpendicularStartY = tangentStartY;
    // var perpendicularEndX = perpendicularStartX + 10 * Math.cos(Math.atan(perpendicularSlope)); // 使用切线长度和斜率计算切线的结束点
    // var perpendicularEndY = perpendicularStartY + 10 * Math.sin(Math.atan(perpendicularSlope));

    // 绘制切线
    context.beginPath();
    context.moveTo(x, y);
    context.lineTo(dx, dy);
    context.stroke();
}
  </script>
</body>
</html>